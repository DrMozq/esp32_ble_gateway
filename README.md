# üõ∞Ô∏è esp32_ble_gateway

**esp32_ble_gateway** ‚Äî —ç—Ç–æ –ø—Ä–æ—à–∏–≤–∫–∞ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ **ESP32**, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è —Ä–æ–ª—å BLE ‚Üí MQTT —à–ª—é–∑–∞.  
–û–Ω–∞ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç BLE-–º–µ—Ç–∫–∏ (–Ω–∞ –±–∞–∑–µ nRF52832), —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Ö –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ MQTT-–±—Ä–æ–∫–µ—Ä –ø–æ Wi-Fi.  
–ü—Ä–æ–µ–∫—Ç —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç NTP –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –ª–æ–≥–æ–≤ –ø–æ Serial –∏ –≤ MQTT.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Wi-Fi —Å –ø–æ–º–æ—â—å—é **WiFiManager**  
- ‚òÅÔ∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ **MQTT-–±—Ä–æ–∫–µ—Ä—É** —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π  
- ‚è∞ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ **NTP**  
- üß© –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Wi-Fi, MQTT, BLE, NTP, –ª–æ–≥–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)  
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ **LittleFS**  
- üí° –°–≤–µ—Ç–æ–¥–∏–æ–¥-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ Wi-Fi  
- üîÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ  


---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
esp32_ble_gateway/
‚îú‚îÄ‚îÄ src/
‚îÇ ‚îú‚îÄ‚îÄ main.cpp              # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
‚îÇ ‚îú‚îÄ‚îÄ wifi_module.h/.cpp    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Wi-Fi
‚îÇ ‚îú‚îÄ‚îÄ mqtt_module.h/.cpp    # –†–∞–±–æ—Ç–∞ —Å MQTT
‚îÇ ‚îú‚îÄ‚îÄ ntp_module.h/.cpp     # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
‚îÇ ‚îú‚îÄ‚îÄ ble_module.h/.cpp     # –ü–æ–∏—Å–∫ BLE-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ (nRF52832)
‚îÇ ‚îú‚îÄ‚îÄ logs.h/.cpp           # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
| ‚îú‚îÄ‚îÄ config.h/.cpp         # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ MQTT –≤ LittleFS
| ‚îî‚îÄ‚îÄ secrets.h # –ù–∞–∑–≤–∞–Ω–∏–µ —à–ª—é–∑–∞, –ø–∞—Ä–æ–ª—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞
‚îú‚îÄ‚îÄ platformio.ini # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ 
‚îî‚îÄ‚îÄ README.md # –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
```
---

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∫–ª—é—á–µ–Ω–∏–∏ **WiFiManager** —Å–æ–∑–¥–∞—ë—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä `esp32_gateway_AP`.  
–ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å:

- SSID –∏ –ø–∞—Ä–æ–ª—å Wi-Fi  
- MQTT —Å–µ—Ä–≤–µ—Ä (–∞–¥—Ä–µ—Å)
- MQTT –ø–æ—Ä—Ç
- MQTT –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å  

–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ **LittleFS** (–≤ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä `/config.json`).

---

### 2. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ESP32:
- –ú–æ–¥—É–ª—å `config.cpp` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã;
- `wifi_module` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π Wi-Fi —Å–µ—Ç–∏;
- `mqtt_module` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MQTT-–±—Ä–æ–∫–µ—Ä—É.

---

### 3. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ö–æ–≥–¥–∞ Wi-Fi –∏ MQTT —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–¥—É–ª—å NTP**  
   ‚Äî –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è —Å —Å–µ—Ä–≤–µ—Ä–∞ `pool.ntp.org` –∏          —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —á–∞—Å—ã ESP32 –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç.
   –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ—á–Ω–æ–π –æ—Ç–º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ BLE-—Å–æ–±—ã—Ç–∏–π –∏ –ª–æ–≥–æ–≤.
   –°–∏–º–≤–æ–ª "‚úì" —Ä—è–¥–æ–º —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º (–≤ –ª–æ–≥–∞—Ö), –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å –ø–æ–º–æ—â—å—é NTP. –°–∏–º–≤–æ–ª "‚úó" –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–∏–ª–æ—Å—å —Å –ø–æ–º–æ—â—å—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —á–∞—Å–æ–≤ esp32.

2. **–ó–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–¥—É–ª—å BLE**  
   ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Bluetooth LE —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–º–∞—è–∫–æ–≤ –Ω–∞ –±–∞–∑–µ nRF52832);  
   ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (MAC-–∞–¥—Ä–µ—Å, RSSI, NAME) –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ manufacturerID;
   ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ json –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ MQTT.

3. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ MQTT-–±—Ä–æ–∫–µ—Ä**  
   ‚Äî –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ (`loopInterval = 2000 –º—Å`) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è;  
   ‚Äî –ø—É–±–ª–∏–∫—É–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ BLE-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Ç–æ–ø–∏–∫ `esp32_ble_gateway/nrf_devices` –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON;  
   ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –ª–æ–≥–∏ –≤ —Ç–æ–ø–∏–∫ `esp32_ble_gateway/logs`.

4. **–°–ª–µ–¥–∏—Ç –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**
   - –µ—Å–ª–∏ Wi-Fi –ø–æ—Ç–µ—Ä—è–Ω ‚Äî –æ—Ç–∫–ª—é—á–∞–µ—Ç LED, –≤—ã–∑—ã–≤–∞–µ—Ç `resetWiFi()` –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è;  
   - –µ—Å–ª–∏ MQTT –ø–æ—Ç–µ—Ä—è–Ω ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç `connectMQTT()` –∏ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ —Ç–∞–∫–∂–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç Wi-Fi;  

5. **–û–±–Ω–æ–≤–ª—è–µ—Ç LED-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä**  
   - üî¥ **–í—ã–∫–ª—é—á–µ–Ω** ‚Äî Wi-Fi –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω, —Å–æ–∑–¥–∞–Ω–∞ —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞;  
   - üü¢ **–ì–æ—Ä–∏—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ** ‚Äî Wi-Fi –ø–æ–¥–∫–ª—é—á–µ–Ω, MQTT –∞–∫—Ç–∏–≤–µ–Ω.

---

## üß† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- [Arduino Framework](https://www.arduino.cc/)
- [ESP32](https://www.espressif.com/en/products/socs/esp32)
- [WiFiManager](https://github.com/tzapu/WiFiManager)
- [PubSubClient](https://github.com/knolleary/pubsubclient)
- [NTPClient](https://github.com/arduino-libraries/NTPClient)
- [ArduinoJson](https://arduinojson.org/)
- [LittleFS](https://github.com/lorol/LITTLEFS)

---


## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ¬© 2025 ‚Äî –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: [drmozq]

