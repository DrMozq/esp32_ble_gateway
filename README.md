# üõ∞Ô∏è esp32_ble_gateway

**esp32_ble_gateway** ‚Äî —ç—Ç–æ –ø—Ä–æ—à–∏–≤–∫–∞ –¥–ª—è –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ **ESP32**, –≤—ã–ø–æ–ª–Ω—è—é—â–∞—è —Ä–æ–ª—å BLE ‚Üí MQTT —à–ª—é–∑–∞.  
–û–Ω–∞ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç BLE-–º–µ—Ç–∫–∏ (–Ω–∞ –±–∞–∑–µ nRF52832), —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Ö –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –Ω–∞ MQTT-–±—Ä–æ–∫–µ—Ä –ø–æ Wi-Fi.  
–ü—Ä–æ–µ–∫—Ç —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç NTP –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –ª–æ–≥–æ–≤ –ø–æ Serial –∏ –≤ MQTT.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîß –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Wi-Fi —Å –ø–æ–º–æ—â—å—é **WiFiManager**  
- ‚òÅÔ∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ **MQTT-–±—Ä–æ–∫–µ—Ä—É** —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π  
- ‚è∞ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ **NTP**  
- üß© –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Wi-Fi, MQTT, BLE, NTP, –ª–æ–≥–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)  
- üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ **LittleFS**  
- üí° –°–≤–µ—Ç–æ–¥–∏–æ–¥-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ Wi-Fi  
- üîÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ  


---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
esp32_ble_gateway/
‚îú‚îÄ‚îÄ src/
‚îÇ ‚îú‚îÄ‚îÄ main.cpp              # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã
‚îÇ ‚îú‚îÄ‚îÄ wifi_module.h/.cpp    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Wi-Fi
‚îÇ ‚îú‚îÄ‚îÄ mqtt_module.h/.cpp    # –†–∞–±–æ—Ç–∞ —Å MQTT
‚îÇ ‚îú‚îÄ‚îÄ ntp_module.h/.cpp     # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏
‚îÇ ‚îú‚îÄ‚îÄ ble_module.h/.cpp     # –ü–æ–∏—Å–∫ BLE-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ (nRF52832)
‚îÇ ‚îú‚îÄ‚îÄ logs.h/.cpp           # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
| ‚îú‚îÄ‚îÄ config.h/.cpp         # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ MQTT –≤ LittleFS
| ‚îî‚îÄ‚îÄ secrets.h             # c–ø–∏—Å–æ–∫ MAC-–∞–¥—Ä–µ—Å–æ–≤ –º–µ—Ç–æ–∫ –∏ –∫–ª—é—á–∏ AP
‚îú‚îÄ‚îÄ platformio.ini          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ 
‚îî‚îÄ‚îÄ README.md               # –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
```
---

## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–ü–µ—Ä–µ–¥ –ø—Ä–æ—à–∏–≤–∫–æ–π –≤ —Ñ–∞–π–ª–µ `src/secrets.h` –∑–∞–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ `TARGET_TAGS`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π MAC-–∞–¥—Ä–µ—Å–∞ –º–µ—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å.

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ WiFiManager
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ (–∏–ª–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è) ESP32 —Å–æ–∑–¥–∞–µ—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞. –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è:
- SSID/–ü–∞—Ä–æ–ª—å Wi-Fi.
- –ê–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç MQTT-–±—Ä–æ–∫–µ—Ä–∞.
- –õ–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è MQTT.
–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/config.json` –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø–∞–º—è—Ç–∏ LittleFS.

### 3. –†–∞–±–æ—á–∏–π —Ü–∏–∫–ª (Loop)
–ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥:
1. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏**: NTP-–º–æ–¥—É–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —á–∞—Å—ã (–æ—Ç–º–µ—Ç–∫–∞ "‚úì" –≤ –ª–æ–≥–∞—Ö –æ–∑–Ω–∞—á–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–π –∞–ø–¥–µ–π—Ç).
2. **BLE —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ú–æ–¥—É–ª—å —Å–∫–∞–Ω–∏—Ä—É–µ—Ç —ç—Ñ–∏—Ä, –∏—â–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ `TARGET_TAGS`.
3. **–ü—É–±–ª–∏–∫–∞—Ü–∏—è**:
   - –î–∞–Ω–Ω—ã–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ (MAC –∏ RSSI) –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —Ç–æ–ø–∏–∫ `{GATEWAY_NAME}/ble_tags` –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
   - –°–ª—É–∂–µ–±–Ω—ã–µ –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —Ç–æ–ø–∏–∫ `{GATEWAY_NAME}/logs`.
4. **–ò–Ω–¥–∏–∫–∞—Ü–∏—è**: –°–≤–µ—Ç–æ–¥–∏–æ–¥ (GPIO 2) –≥–æ—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ Wi-Fi –∏ MQTT —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.

### 4. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ MQTT —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —à–ª—é–∑ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ Wi-Fi —Å–∏—Å—Ç–µ–º–∞ –∂–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞.
- –ó–∞–≤–æ–¥—Å–∫–æ–π —Å–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ Wi-Fi (Factory Reset) –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `resetWiFi`) –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏, –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω–æ–π –∫ GPIO 4.

---

## üß† –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- [Arduino Framework](https://www.arduino.cc/) & [PlatformIO](https://platformio.org/)
- [WiFiManager](https://github.com/tzapu/WiFiManager) ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏.
- [PubSubClient](https://github.com/knolleary/pubsubclient) ‚Äî MQTT –∫–ª–∏–µ–Ω—Ç.
- [ArduinoJson](https://arduinojson.org/) ‚Äî —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
- [NTPClient](https://github.com/arduino-libraries/NTPClient) ‚Äî —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è.

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è
MIT ¬© 2025 ‚Äî –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: [drmozq]